% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/dbUpsertDataMssql.R
\name{dbUpsertDataMssql}
\alias{dbUpsertDataMssql}
\title{Upsert Data to SQL Server with MERGE and Chunking}
\usage{
dbUpsertDataMssql(
  conn,
  new.data,
  schema.name,
  table.name,
  key.cols,
  timestamp.col,
  keep = "last",
  chunk.size = 10000L,
  check.schema = TRUE,
  verbose = TRUE
)
}
\arguments{
\item{conn}{A valid SQL Server connection object (from \pkg{DBI}).}

\item{new.data}{A non-empty `data.frame` with new data to upsert.}

\item{schema.name}{Character string naming the target schema (default: `"dbo"`).}

\item{table.name}{Character string naming the target table.}

\item{key.cols}{Character vector of column names forming the primary key.}

\item{timestamp.col}{Character scalar, the column used for conflict resolution.}

\item{keep}{`"first"` or `"last"`; whether to keep the earliest or latest record
on timestamp conflicts. Default is `"last"`.}

\item{chunk.size}{Integer, number of rows per insert chunk. Default is `10000`.}

\item{check.schema}{Logical; whether to validate schema compatibility. Default is `TRUE`.}

\item{verbose}{Logical; whether to print progress messages. Default is `TRUE`.}
}
\value{
A `data.frame` transaction log.
}
\description{
Efficiently upserts large data frames into a SQL Server table using
`MERGE` and chunked inserts. If the target table does not exist, it is
created. Conflicts on key columns are resolved by comparing timestamps,
keeping either the earliest or latest record.
}
\details{
The function returns a transaction log as a `data.frame`. Each row records
an operation: initial insert, merge, or cleanup.

Transaction log columns:
\describe{
  \item{operation}{Type of operation ("insert_new_table", "merge", "cleanup").}
  \item{chunk}{Chunk number (if applicable).}
  \item{rows}{Number of rows inserted, updated, or processed.}
  \item{start_row}{First row index of the chunk (if applicable).}
  \item{end_row}{Last row index of the chunk (if applicable).}
  \item{status}{Operation status ("success" or "failed").}
  \item{message}{Details, e.g. "inserted=100, updated=50".}
  \item{timestamp}{Time the operation was logged (POSIXct, UTC).}
}
}
\examples{
\dontrun{
log.df <- dbUpsertDataMssql(
  conn = con,
  new.data = data.df,
  schema.name = "dbo",
  table.name = "events",
  key.cols = "event_id",
  timestamp.col = "updated_at"
)
}
}
